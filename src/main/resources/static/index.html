<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanzApp - Gesti√≥n Financiera Personal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .notification-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }

        .scroll-smooth {
            scroll-behavior: smooth;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useCallback, useMemo } = React;

        // API Configuration
        const API_BASE_URL = 'http://localhost:8080/api';

        // Utility Functions
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: 'ARS'
            }).format(amount || 0);
        };

        const formatDate = (dateString) => {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('es-AR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        };

        // API Helper
        const api = {
            async request(endpoint, options = {}) {
                const token = localStorage.getItem('token');
                const headers = {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` }),
                    ...options.headers
                };

                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        ...options,
                        headers
                    });

                    if (response.status === 401) {
                        localStorage.removeItem('token');
                        window.location.reload();
                        return null;
                    }

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.message || 'Error en la solicitud');
                    }

                    // Handle 204 No Content
                    if (response.status === 204) {
                        return null;
                    }

                    return await response.json();
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            },

            get(endpoint) {
                return this.request(endpoint);
            },

            post(endpoint, data) {
                return this.request(endpoint, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            },

            put(endpoint, data) {
                return this.request(endpoint, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });
            },

            patch(endpoint, data) {
                return this.request(endpoint, {
                    method: 'PATCH',
                    body: data ? JSON.stringify(data) : undefined
                });
            },

            delete(endpoint) {
                return this.request(endpoint, {
                    method: 'DELETE'
                });
            }
        };

        // Icons Component
        const Icons = {
            Dashboard: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            ),
            Movements: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
            ),
            Budget: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
            ),
            Notifications: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
            ),
            Reports: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            ),
            Plus: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
            ),
            TrendUp: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
            ),
            TrendDown: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                </svg>
            ),
            Logout: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
            )
        };

        // Login Component
        const LoginForm = ({ onLoginSuccess }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({
                email: '',
                password: '',
                nombre: ''
            });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                try {
                    const endpoint = isLogin ? '/auth/login' : '/auth/register';
                    const payload = isLogin
                        ? { email: formData.email, password: formData.password }
                        : formData;

                    const data = await api.post(endpoint, payload);

                    if (data && data.token) {
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('user', JSON.stringify({
                            id: data.id,
                            nombre: data.nombre,
                            email: data.email
                        }));
                        onLoginSuccess();
                    }
                } catch (err) {
                    setError(err.message || 'Error en la autenticaci√≥n');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center gradient-bg py-12 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-md w-full space-y-8">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div>
                                <h2 className="text-center text-4xl font-extrabold text-gray-900 mb-2">
                                    üí∞ FinanzApp
                                </h2>
                                <p className="text-center text-sm text-gray-600">
                                    {isLogin ? 'Inicia sesi√≥n en tu cuenta' : 'Crea tu cuenta'}
                                </p>
                            </div>

                            <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
                                {error && (
                                    <div className="rounded-md bg-red-50 p-4">
                                        <p className="text-sm text-red-800">{error}</p>
                                    </div>
                                )}

                                <div className="space-y-4">
                                    {!isLogin && (
                                        <div>
                                            <label htmlFor="nombre" className="block text-sm font-medium text-gray-700">
                                                Nombre completo
                                            </label>
                                            <input
                                                id="nombre"
                                                name="nombre"
                                                type="text"
                                                required={!isLogin}
                                                className="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                placeholder="Juan P√©rez"
                                                value={formData.nombre}
                                                onChange={(e) => setFormData({...formData, nombre: e.target.value})}
                                            />
                                        </div>
                                    )}

                                    <div>
                                        <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                                            Email
                                        </label>
                                        <input
                                            id="email"
                                            name="email"
                                            type="email"
                                            required
                                            className="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="tu@email.com"
                                            value={formData.email}
                                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        />
                                    </div>

                                    <div>
                                        <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                                            Contrase√±a
                                        </label>
                                        <input
                                            id="password"
                                            name="password"
                                            type="password"
                                            required
                                            className="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            value={formData.password}
                                            onChange={(e) => setFormData({...formData, password: e.target.value})}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                    >
                                        {loading ? 'Procesando...' : (isLogin ? 'Iniciar Sesi√≥n' : 'Registrarse')}
                                    </button>
                                </div>

                                <div className="text-center">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setIsLogin(!isLogin);
                                            setError('');
                                        }}
                                        className="text-sm text-indigo-600 hover:text-indigo-500"
                                    >
                                        {isLogin ? '¬øNo tienes cuenta? Reg√≠strate' : '¬øYa tienes cuenta? Inicia sesi√≥n'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // Dashboard Component
        const Dashboard = ({ data, onRefresh }) => {
            const { resumen, movimientos, categorias, presupuestos } = data;

            useEffect(() => {
                // Create charts when data is available
                if (resumen && categorias.length > 0) {
                    createCharts();
                }
            }, [resumen, categorias]);

            const createCharts = () => {
                // Income vs Expenses Chart
                const ctx1 = document.getElementById('incomeExpenseChart');
                if (ctx1) {
                    const chart1 = Chart.getChart(ctx1);
                    if (chart1) chart1.destroy();

                    new Chart(ctx1, {
                        type: 'doughnut',
                        data: {
                            labels: ['Ingresos', 'Egresos'],
                            datasets: [{
                                data: [resumen.ingresos, resumen.egresos],
                                backgroundColor: ['#10b981', '#ef4444'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }

                // Categories Chart
                const ctx2 = document.getElementById('categoriesChart');
                if (ctx2 && categorias.length > 0) {
                    const chart2 = Chart.getChart(ctx2);
                    if (chart2) chart2.destroy();

                    new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: categorias.map(c => c.categoria),
                            datasets: [{
                                label: 'Monto',
                                data: categorias.map(c => c.total),
                                backgroundColor: '#6366f1',
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            };

            return (
                <div className="space-y-6">
                    {/* Stats Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white card-hover">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-green-100 text-sm font-medium">Ingresos</p>
                                    <p className="text-2xl font-bold mt-1">{formatCurrency(resumen.ingresos)}</p>
                                </div>
                                <div className="bg-white bg-opacity-30 rounded-full p-3">
                                    <Icons.TrendUp />
                                </div>
                            </div>
                        </div>

                        <div className="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white card-hover">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-red-100 text-sm font-medium">Egresos</p>
                                    <p className="text-2xl font-bold mt-1">{formatCurrency(resumen.egresos)}</p>
                                </div>
                                <div className="bg-white bg-opacity-30 rounded-full p-3">
                                    <Icons.TrendDown />
                                </div>
                            </div>
                        </div>

                        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white card-hover">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-blue-100 text-sm font-medium">Balance</p>
                                    <p className="text-2xl font-bold mt-1">{formatCurrency(resumen.balance)}</p>
                                </div>
                                <div className="bg-white bg-opacity-30 rounded-full p-3">
                                    <Icons.Dashboard />
                                </div>
                            </div>
                        </div>

                        <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white card-hover">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-orange-100 text-sm font-medium">Deudas</p>
                                    <p className="text-2xl font-bold mt-1">{formatCurrency(resumen.deudas)}</p>
                                </div>
                                <div className="bg-white bg-opacity-30 rounded-full p-3">
                                    <Icons.Notifications />
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Charts */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Ingresos vs Egresos</h3>
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Por Categor√≠a</h3>
                            <canvas id="categoriesChart"></canvas>
                        </div>
                    </div>

                    {/* Recent Movements */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-semibold text-gray-800">Movimientos Recientes</h3>
                            <button
                                onClick={onRefresh}
                                className="text-sm text-indigo-600 hover:text-indigo-700 font-medium"
                            >
                                Ver todos
                            </button>
                        </div>
                        <div className="space-y-3">
                            {movimientos.slice(0, 5).map((mov) => (
                                <div key={mov.id} className="flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition-colors">
                                    <div className="flex items-center space-x-4">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                                            mov.tipo === 'INGRESO' ? 'bg-green-100' : 'bg-red-100'
                                        }`}>
                                            {mov.tipo === 'INGRESO' ? (
                                                <Icons.TrendUp className={mov.tipo === 'INGRESO' ? 'text-green-600' : 'text-red-600'} />
                                            ) : (
                                                <Icons.TrendDown className={mov.tipo === 'INGRESO' ? 'text-green-600' : 'text-red-600'} />
                                            )}
                                        </div>
                                        <div>
                                            <p className="font-medium text-gray-900">{mov.descripcion}</p>
                                            <p className="text-sm text-gray-500">{formatDate(mov.fecha)}</p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className={`font-semibold ${
                                            mov.tipo === 'INGRESO' ? 'text-green-600' : 'text-red-600'
                                        }`}>
                                            {mov.tipo === 'INGRESO' ? '+' : '-'} {formatCurrency(mov.monto)}
                                        </p>
                                        <span className={`text-xs px-2 py-1 rounded-full ${
                                            mov.pagado ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                        }`}>
                                            {mov.pagado ? 'Pagado' : 'Pendiente'}
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Budgets Summary */}
                    {presupuestos.length > 0 && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Presupuestos del Mes</h3>
                            <div className="space-y-4">
                                {presupuestos.map((presupuesto) => {
                                    const porcentaje = presupuesto.porcentajeUtilizado || 0;
                                    const isOver = porcentaje > 100;
                                    const isWarning = porcentaje >= (presupuesto.alertaPorcentaje || 80);

                                    return (
                                        <div key={presupuesto.id} className="space-y-2">
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm font-medium text-gray-700">
                                                    {presupuesto.nombre}
                                                </span>
                                                <span className={`text-sm font-semibold ${
                                                    isOver ? 'text-red-600' : isWarning ? 'text-orange-600' : 'text-gray-600'
                                                }`}>
                                                    {porcentaje.toFixed(1)}%
                                                </span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                <div
                                                    className={`h-2 rounded-full transition-all ${
                                                        isOver ? 'bg-red-600' : isWarning ? 'bg-orange-500' : 'bg-green-500'
                                                    }`}
                                                    style={{ width: `${Math.min(porcentaje, 100)}%` }}
                                                ></div>
                                            </div>
                                            <div className="flex items-center justify-between text-xs text-gray-500">
                                                <span>{formatCurrency(presupuesto.montoGastado)} gastado</span>
                                                <span>{formatCurrency(presupuesto.montoLimite)} l√≠mite</span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Movements Component
        const MovementsList = ({ movimientos, categorias, onUpdate }) => {
            const [showModal, setShowModal] = useState(false);
            const [editingMovement, setEditingMovement] = useState(null);
            const [filters, setFilters] = useState({
                tipo: '',
                pagado: '',
                categoriaId: ''
            });

            const [formData, setFormData] = useState({
                descripcion: '',
                tipo: 'EGRESO',
                monto: '',
                fecha: new Date().toISOString().split('T')[0],
                fechaVencimiento: '',
                pagado: false,
                categoriaId: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    if (editingMovement) {
                        await api.put(`/movimientos/${editingMovement.id}`, {
                            ...formData,
                            monto: parseFloat(formData.monto)
                        });
                    } else {
                        await api.post('/movimientos', {
                            ...formData,
                            monto: parseFloat(formData.monto)
                        });
                    }
                    setShowModal(false);
                    setEditingMovement(null);
                    resetForm();
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const resetForm = () => {
                setFormData({
                    descripcion: '',
                    tipo: 'EGRESO',
                    monto: '',
                    fecha: new Date().toISOString().split('T')[0],
                    fechaVencimiento: '',
                    pagado: false,
                    categoriaId: ''
                });
            };

            const handleEdit = (mov) => {
                setEditingMovement(mov);
                setFormData({
                    descripcion: mov.descripcion,
                    tipo: mov.tipo,
                    monto: mov.monto.toString(),
                    fecha: mov.fecha,
                    fechaVencimiento: mov.fechaVencimiento || '',
                    pagado: mov.pagado,
                    categoriaId: mov.categoriaId.toString()
                });
                setShowModal(true);
            };

            const handleDelete = async (id) => {
                if (confirm('¬øEst√°s seguro de eliminar este movimiento?')) {
                    try {
                        await api.delete(`/movimientos/${id}`);
                        onUpdate();
                    } catch (error) {
                        alert('Error: ' + error.message);
                    }
                }
            };

            const togglePaid = async (mov) => {
                try {
                    const endpoint = mov.pagado ? `/movimientos/${mov.id}/pendiente` : `/movimientos/${mov.id}/pagar`;
                    await api.patch(endpoint);
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const filteredMovements = movimientos.filter(mov => {
                if (filters.tipo && mov.tipo !== filters.tipo) return false;
                if (filters.pagado !== '' && mov.pagado.toString() !== filters.pagado) return false;
                if (filters.categoriaId && mov.categoriaId.toString() !== filters.categoriaId) return false;
                return true;
            });

            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="flex items-center justify-between">
                        <h2 className="text-2xl font-bold text-gray-900">Movimientos</h2>
                        <button
                            onClick={() => {
                                setEditingMovement(null);
                                resetForm();
                                setShowModal(true);
                            }}
                            className="flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                        >
                            <Icons.Plus />
                            <span>Nuevo Movimiento</span>
                        </button>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <select
                                value={filters.tipo}
                                onChange={(e) => setFilters({...filters, tipo: e.target.value})}
                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                <option value="">Todos los tipos</option>
                                <option value="INGRESO">Ingresos</option>
                                <option value="EGRESO">Egresos</option>
                            </select>

                            <select
                                value={filters.pagado}
                                onChange={(e) => setFilters({...filters, pagado: e.target.value})}
                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                <option value="">Todos los estados</option>
                                <option value="true">Pagados</option>
                                <option value="false">Pendientes</option>
                            </select>

                            <select
                                value={filters.categoriaId}
                                onChange={(e) => setFilters({...filters, categoriaId: e.target.value})}
                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                                <option value="">Todas las categor√≠as</option>
                                {categorias.map(cat => (
                                    <option key={cat.id} value={cat.id}>{cat.nombre}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    {/* Movements List */}
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Descripci√≥n
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Tipo
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Monto
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Fecha
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Estado
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Acciones
                                        </th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredMovements.map((mov) => (
                                        <tr key={mov.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm font-medium text-gray-900">{mov.descripcion}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                    mov.tipo === 'INGRESO'
                                                        ? 'bg-green-100 text-green-800'
                                                        : 'bg-red-100 text-red-800'
                                                }`}>
                                                    {mov.tipo}
                                                </span>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className={`text-sm font-semibold ${
                                                    mov.tipo === 'INGRESO' ? 'text-green-600' : 'text-red-600'
                                                }`}>
                                                    {formatCurrency(mov.monto)}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm text-gray-900">{formatDate(mov.fecha)}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <button
                                                    onClick={() => togglePaid(mov)}
                                                    className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full cursor-pointer ${
                                                        mov.pagado
                                                            ? 'bg-green-100 text-green-800 hover:bg-green-200'
                                                            : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'
                                                    }`}
                                                >
                                                    {mov.pagado ? 'Pagado' : 'Pendiente'}
                                                </button>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button
                                                    onClick={() => handleEdit(mov)}
                                                    className="text-indigo-600 hover:text-indigo-900"
                                                >
                                                    Editar
                                                </button>
                                                <button
                                                    onClick={() => handleDelete(mov.id)}
                                                    className="text-red-600 hover:text-red-900"
                                                >
                                                    Eliminar
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-6">
                                <h3 className="text-xl font-bold text-gray-900 mb-4">
                                    {editingMovement ? 'Editar Movimiento' : 'Nuevo Movimiento'}
                                </h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Descripci√≥n
                                        </label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.descripcion}
                                            onChange={(e) => setFormData({...formData, descripcion: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Tipo
                                            </label>
                                            <select
                                                value={formData.tipo}
                                                onChange={(e) => setFormData({...formData, tipo: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            >
                                                <option value="INGRESO">Ingreso</option>
                                                <option value="EGRESO">Egreso</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Monto
                                            </label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.monto}
                                                onChange={(e) => setFormData({...formData, monto: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Categor√≠a
                                        </label>
                                        <select
                                            required
                                            value={formData.categoriaId}
                                            onChange={(e) => setFormData({...formData, categoriaId: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        >
                                            <option value="">Selecciona una categor√≠a</option>
                                            {categorias.filter(c => c.tipo === formData.tipo || c.tipo === 'AMBOS').map(cat => (
                                                <option key={cat.id} value={cat.id}>{cat.nombre}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Fecha
                                            </label>
                                            <input
                                                type="date"
                                                required
                                                value={formData.fecha}
                                                onChange={(e) => setFormData({...formData, fecha: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Vencimiento
                                            </label>
                                            <input
                                                type="date"
                                                value={formData.fechaVencimiento}
                                                onChange={(e) => setFormData({...formData, fechaVencimiento: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            />
                                        </div>
                                    </div>

                                    <div className="flex items-center">
                                        <input
                                            type="checkbox"
                                            id="pagado"
                                            checked={formData.pagado}
                                            onChange={(e) => setFormData({...formData, pagado: e.target.checked})}
                                            className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        />
                                        <label htmlFor="pagado" className="ml-2 block text-sm text-gray-900">
                                            Marcar como pagado
                                        </label>
                                    </div>

                                    <div className="flex space-x-3 pt-4">
                                        <button
                                            type="submit"
                                            className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                        >
                                            {editingMovement ? 'Actualizar' : 'Crear'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setShowModal(false);
                                                setEditingMovement(null);
                                                resetForm();
                                            }}
                                            className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Budgets Component
        const BudgetsList = ({ presupuestos, categorias, onUpdate }) => {
            const [showModal, setShowModal] = useState(false);
            const [editingBudget, setEditingBudget] = useState(null);
            const [formData, setFormData] = useState({
                nombre: '',
                montoLimite: '',
                mes: new Date().getMonth() + 1,
                anio: new Date().getFullYear(),
                categoriaId: '',
                alertaPorcentaje: 80,
                activo: true
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const payload = {
                        ...formData,
                        montoLimite: parseFloat(formData.montoLimite),
                        categoriaId: formData.categoriaId ? parseInt(formData.categoriaId) : null
                    };

                    if (editingBudget) {
                        await api.put(`/presupuestos/${editingBudget.id}`, payload);
                    } else {
                        await api.post('/presupuestos', payload);
                    }
                    setShowModal(false);
                    setEditingBudget(null);
                    resetForm();
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const resetForm = () => {
                setFormData({
                    nombre: '',
                    montoLimite: '',
                    mes: new Date().getMonth() + 1,
                    anio: new Date().getFullYear(),
                    categoriaId: '',
                    alertaPorcentaje: 80,
                    activo: true
                });
            };

            const handleEdit = (budget) => {
                setEditingBudget(budget);
                setFormData({
                    nombre: budget.nombre,
                    montoLimite: budget.montoLimite.toString(),
                    mes: budget.mes,
                    anio: budget.anio,
                    categoriaId: budget.categoriaId?.toString() || '',
                    alertaPorcentaje: budget.alertaPorcentaje,
                    activo: budget.activo
                });
                setShowModal(true);
            };

            const handleDelete = async (id) => {
                if (confirm('¬øEst√°s seguro de eliminar este presupuesto?')) {
                    try {
                        await api.delete(`/presupuestos/${id}`);
                        onUpdate();
                    } catch (error) {
                        alert('Error: ' + error.message);
                    }
                }
            };

            const meses = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];

            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="flex items-center justify-between">
                        <h2 className="text-2xl font-bold text-gray-900">Presupuestos</h2>
                        <button
                            onClick={() => {
                                setEditingBudget(null);
                                resetForm();
                                setShowModal(true);
                            }}
                            className="flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                        >
                            <Icons.Plus />
                            <span>Nuevo Presupuesto</span>
                        </button>
                    </div>

                    {/* Budgets Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {presupuestos.map((presupuesto) => {
                            const porcentaje = presupuesto.porcentajeUtilizado || 0;
                            const isOver = porcentaje > 100;
                            const isWarning = porcentaje >= (presupuesto.alertaPorcentaje || 80);

                            return (
                                <div key={presupuesto.id} className="bg-white rounded-xl shadow-lg p-6 card-hover">
                                    <div className="flex items-start justify-between mb-4">
                                        <div>
                                            <h3 className="font-semibold text-gray-900">{presupuesto.nombre}</h3>
                                            <p className="text-sm text-gray-500">{meses[presupuesto.mes - 1]} {presupuesto.anio}</p>
                                        </div>
                                        <span className={`px-2 py-1 text-xs font-semibold rounded-full ${
                                            presupuesto.activo
                                                ? 'bg-green-100 text-green-800'
                                                : 'bg-gray-100 text-gray-800'
                                        }`}>
                                            {presupuesto.activo ? 'Activo' : 'Inactivo'}
                                        </span>
                                    </div>

                                    <div className="space-y-3">
                                        <div>
                                            <div className="flex items-center justify-between mb-1">
                                                <span className="text-sm text-gray-600">Progreso</span>
                                                <span className={`text-sm font-bold ${
                                                    isOver ? 'text-red-600' : isWarning ? 'text-orange-600' : 'text-gray-900'
                                                }`}>
                                                    {porcentaje.toFixed(1)}%
                                                </span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-3">
                                                <div
                                                    className={`h-3 rounded-full transition-all ${
                                                        isOver ? 'bg-red-600' : isWarning ? 'bg-orange-500' : 'bg-green-500'
                                                    }`}
                                                    style={{ width: `${Math.min(porcentaje, 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="pt-3 border-t border-gray-200 space-y-2">
                                            <div className="flex items-center justify-between text-sm">
                                                <span className="text-gray-600">Gastado:</span>
                                                <span className="font-semibold text-gray-900">
                                                    {formatCurrency(presupuesto.montoGastado)}
                                                </span>
                                            </div>
                                            <div className="flex items-center justify-between text-sm">
                                                <span className="text-gray-600">L√≠mite:</span>
                                                <span className="font-semibold text-gray-900">
                                                    {formatCurrency(presupuesto.montoLimite)}
                                                </span>
                                            </div>
                                            <div className="flex items-center justify-between text-sm">
                                                <span className="text-gray-600">Disponible:</span>
                                                <span className={`font-semibold ${
                                                    (presupuesto.montoDisponible || 0) < 0 ? 'text-red-600' : 'text-green-600'
                                                }`}>
                                                    {formatCurrency(presupuesto.montoDisponible)}
                                                </span>
                                            </div>
                                        </div>

                                        <div className="pt-3 border-t border-gray-200 flex space-x-2">
                                            <button
                                                onClick={() => handleEdit(presupuesto)}
                                                className="flex-1 px-3 py-2 text-sm bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 transition-colors font-medium"
                                            >
                                                Editar
                                            </button>
                                            <button
                                                onClick={() => handleDelete(presupuesto.id)}
                                                className="flex-1 px-3 py-2 text-sm bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors font-medium"
                                            >
                                                Eliminar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}

                        {presupuestos.length === 0 && (
                            <div className="col-span-full text-center py-12">
                                <Icons.Budget className="mx-auto h-12 w-12 text-gray-400" />
                                <h3 className="mt-2 text-sm font-medium text-gray-900">No hay presupuestos</h3>
                                <p className="mt-1 text-sm text-gray-500">Comienza creando un nuevo presupuesto.</p>
                            </div>
                        )}
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-6">
                                <h3 className="text-xl font-bold text-gray-900 mb-4">
                                    {editingBudget ? 'Editar Presupuesto' : 'Nuevo Presupuesto'}
                                </h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Nombre
                                        </label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.nombre}
                                            onChange={(e) => setFormData({...formData, nombre: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="Ej: Alimentaci√≥n Enero"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            L√≠mite de Gasto
                                        </label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={formData.montoLimite}
                                            onChange={(e) => setFormData({...formData, montoLimite: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="50000.00"
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Mes
                                            </label>
                                            <select
                                                value={formData.mes}
                                                onChange={(e) => setFormData({...formData, mes: parseInt(e.target.value)})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            >
                                                {meses.map((mes, index) => (
                                                    <option key={index} value={index + 1}>{mes}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                A√±o
                                            </label>
                                            <input
                                                type="number"
                                                required
                                                value={formData.anio}
                                                onChange={(e) => setFormData({...formData, anio: parseInt(e.target.value)})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Categor√≠a (opcional)
                                        </label>
                                        <select
                                            value={formData.categoriaId}
                                            onChange={(e) => setFormData({...formData, categoriaId: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        >
                                            <option value="">Presupuesto General</option>
                                            {categorias.filter(c => c.tipo === 'EGRESO' || c.tipo === 'AMBOS').map(cat => (
                                                <option key={cat.id} value={cat.id}>{cat.nombre}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Alerta al {formData.alertaPorcentaje}%
                                        </label>
                                        <input
                                            type="range"
                                            min="50"
                                            max="95"
                                            step="5"
                                            value={formData.alertaPorcentaje}
                                            onChange={(e) => setFormData({...formData, alertaPorcentaje: parseInt(e.target.value)})}
                                            className="w-full"
                                        />
                                    </div>

                                    <div className="flex items-center">
                                        <input
                                            type="checkbox"
                                            id="activo"
                                            checked={formData.activo}
                                            onChange={(e) => setFormData({...formData, activo: e.target.checked})}
                                            className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        />
                                        <label htmlFor="activo" className="ml-2 block text-sm text-gray-900">
                                            Presupuesto activo
                                        </label>
                                    </div>

                                    <div className="flex space-x-3 pt-4">
                                        <button
                                            type="submit"
                                            className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                        >
                                            {editingBudget ? 'Actualizar' : 'Crear'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setShowModal(false);
                                                setEditingBudget(null);
                                                resetForm();
                                            }}
                                            className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Notifications Component
        const NotificationsCenter = ({ notificaciones, onUpdate }) => {
            const [filter, setFilter] = useState('all'); // all, unread

            const handleMarkAsRead = async (id) => {
                try {
                    await api.patch(`/notificaciones/${id}/leer`);
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const handleMarkAllAsRead = async () => {
                try {
                    await api.patch('/notificaciones/leer-todas');
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const handleDelete = async (id) => {
                try {
                    await api.delete(`/notificaciones/${id}`);
                    onUpdate();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const filteredNotifications = filter === 'unread'
                ? notificaciones.filter(n => !n.leida)
                : notificaciones;

            const getNotificationIcon = (tipo) => {
                switch (tipo) {
                    case 'VENCIMIENTO_PROXIMO':
                    case 'VENCIMIENTO_HOY':
                    case 'VENCIMIENTO_PASADO':
                        return '‚è∞';
                    case 'PRESUPUESTO_ALERTA':
                        return '‚ö†Ô∏è';
                    case 'PRESUPUESTO_SUPERADO':
                        return 'üö®';
                    default:
                        return 'üìå';
                }
            };

            const getNotificationColor = (tipo) => {
                switch (tipo) {
                    case 'VENCIMIENTO_PROXIMO':
                        return 'bg-blue-50 border-blue-200';
                    case 'VENCIMIENTO_HOY':
                        return 'bg-orange-50 border-orange-200';
                    case 'VENCIMIENTO_PASADO':
                        return 'bg-red-50 border-red-200';
                    case 'PRESUPUESTO_ALERTA':
                        return 'bg-yellow-50 border-yellow-200';
                    case 'PRESUPUESTO_SUPERADO':
                        return 'bg-red-50 border-red-200';
                    default:
                        return 'bg-gray-50 border-gray-200';
                }
            };

            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="flex items-center justify-between">
                        <h2 className="text-2xl font-bold text-gray-900">Notificaciones</h2>
                        {notificaciones.some(n => !n.leida) && (
                            <button
                                onClick={handleMarkAllAsRead}
                                className="px-4 py-2 text-sm text-indigo-600 hover:text-indigo-700 font-medium"
                            >
                                Marcar todas como le√≠das
                            </button>
                        )}
                    </div>

                    {/* Filters */}
                    <div className="flex space-x-2">
                        <button
                            onClick={() => setFilter('all')}
                            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                filter === 'all'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            Todas ({notificaciones.length})
                        </button>
                        <button
                            onClick={() => setFilter('unread')}
                            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                filter === 'unread'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            No le√≠das ({notificaciones.filter(n => !n.leida).length})
                        </button>
                    </div>

                    {/* Notifications List */}
                    <div className="space-y-3">
                        {filteredNotifications.length === 0 ? (
                            <div className="text-center py-12 bg-white rounded-xl shadow-lg">
                                <Icons.Notifications className="mx-auto h-12 w-12 text-gray-400" />
                                <h3 className="mt-2 text-sm font-medium text-gray-900">No hay notificaciones</h3>
                                <p className="mt-1 text-sm text-gray-500">
                                    {filter === 'unread' ? 'Todas las notificaciones han sido le√≠das.' : 'No tienes notificaciones a√∫n.'}
                                </p>
                            </div>
                        ) : (
                            filteredNotifications.map((notif) => (
                                <div
                                    key={notif.id}
                                    className={`border-l-4 rounded-lg p-4 ${getNotificationColor(notif.tipo)} ${
                                        !notif.leida ? 'shadow-md' : 'opacity-75'
                                    } card-hover`}
                                >
                                    <div className="flex items-start justify-between">
                                        <div className="flex items-start space-x-3 flex-1">
                                            <span className="text-2xl">{getNotificationIcon(notif.tipo)}</span>
                                            <div className="flex-1">
                                                <div className="flex items-center space-x-2">
                                                    <h4 className="font-semibold text-gray-900">{notif.titulo}</h4>
                                                    {!notif.leida && (
                                                        <span className="w-2 h-2 bg-blue-600 rounded-full notification-badge"></span>
                                                    )}
                                                </div>
                                                <p className="text-sm text-gray-700 mt-1">{notif.mensaje}</p>
                                                <p className="text-xs text-gray-500 mt-2">
                                                    {formatDate(notif.fechaCreacion)}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="flex flex-col space-y-1 ml-4">
                                            {!notif.leida && (
                                                <button
                                                    onClick={() => handleMarkAsRead(notif.id)}
                                                    className="text-xs text-indigo-600 hover:text-indigo-700 font-medium"
                                                >
                                                    Marcar le√≠da
                                                </button>
                                            )}
                                            <button
                                                onClick={() => handleDelete(notif.id)}
                                                className="text-xs text-red-600 hover:text-red-700 font-medium"
                                            >
                                                Eliminar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // Reports Component
        const Reports = () => {
            const [loading, setLoading] = useState(false);
            const [filters, setFilters] = useState({
                tipo: '',
                pagado: '',
                categoriaId: '',
                inicio: '',
                fin: ''
            });

            const handleExport = async (format) => {
                setLoading(true);
                try {
                    const params = new URLSearchParams();
                    if (filters.tipo) params.append('tipo', filters.tipo);
                    if (filters.pagado) params.append('pagado', filters.pagado);
                    if (filters.categoriaId) params.append('categoriaId', filters.categoriaId);
                    if (filters.inicio) params.append('inicio', filters.inicio);
                    if (filters.fin) params.append('fin', filters.fin);

                    const url = `${API_BASE_URL}/export/${format}?${params.toString()}`;
                    const token = localStorage.getItem('token');

                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) throw new Error('Error al exportar');

                    const blob = await response.blob();
                    const downloadUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = `movimientos_${new Date().toISOString().split('T')[0]}.${format}`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(downloadUrl);
                    document.body.removeChild(a);
                } catch (error) {
                    alert('Error al exportar: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-900">Reportes</h2>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4">Filtros de Exportaci√≥n</h3>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Tipo de Movimiento
                                </label>
                                <select
                                    value={filters.tipo}
                                    onChange={(e) => setFilters({...filters, tipo: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                >
                                    <option value="">Todos</option>
                                    <option value="INGRESO">Ingresos</option>
                                    <option value="EGRESO">Egresos</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Estado
                                </label>
                                <select
                                    value={filters.pagado}
                                    onChange={(e) => setFilters({...filters, pagado: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                >
                                    <option value="">Todos</option>
                                    <option value="true">Pagados</option>
                                    <option value="false">Pendientes</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Fecha Inicio
                                </label>
                                <input
                                    type="date"
                                    value={filters.inicio}
                                    onChange={(e) => setFilters({...filters, inicio: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Fecha Fin
                                </label>
                                <input
                                    type="date"
                                    value={filters.fin}
                                    onChange={(e) => setFilters({...filters, fin: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                />
                            </div>
                        </div>

                        <div className="flex space-x-4">
                            <button
                                onClick={() => handleExport('excel')}
                                disabled={loading}
                                className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"
                            >
                                <Icons.Reports />
                                <span>{loading ? 'Exportando...' : 'Exportar a Excel'}</span>
                            </button>
                            <button
                                onClick={() => handleExport('pdf')}
                                disabled={loading}
                                className="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"
                            >
                                <Icons.Reports />
                                <span>{loading ? 'Exportando...' : 'Exportar a PDF'}</span>
                            </button>
                        </div>
                    </div>

                    <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-8 text-white">
                        <h3 className="text-xl font-bold mb-2">üí° Consejo</h3>
                        <p className="text-indigo-100">
                            Los reportes incluyen todos tus movimientos filtrados con totales, subtotales y balance general.
                            √ösalos para llevar un control detallado de tus finanzas o para compartir con tu contador.
                        </p>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentView, setCurrentView] = useState('dashboard');
            const [loading, setLoading] = useState(true);
            const [data, setData] = useState({
                resumen: { ingresos: 0, egresos: 0, balance: 0, deudas: 0 },
                movimientos: [],
                categorias: [],
                presupuestos: [],
                notificaciones: [],
                unreadCount: 0
            });

            useEffect(() => {
                const token = localStorage.getItem('token');
                if (token) {
                    setIsAuthenticated(true);
                    loadData();
                } else {
                    setLoading(false);
                }
            }, []);

            const loadData = async () => {
                setLoading(true);
                try {
                    const [resumenData, movimientosData, categoriasData, presupuestosData, notificacionesData, unreadData] = await Promise.all([
                        Promise.all([
                            api.get('/resumen/ingresos'),
                            api.get('/resumen/egresos'),
                            api.get('/resumen/balance'),
                            api.get('/resumen/deudas'),
                            api.get('/resumen/categorias')
                        ]),
                        api.get('/movimientos?size=100'),
                        api.get('/categorias'),
                        api.get('/presupuestos/mes-actual'),
                        api.get('/notificaciones'),
                        api.get('/notificaciones/contador')
                    ]);

                    setData({
                        resumen: {
                            ingresos: resumenData[0],
                            egresos: resumenData[1],
                            balance: resumenData[2],
                            deudas: resumenData[3]
                        },
                        movimientos: movimientosData.content || [],
                        categorias: categoriasData,
                        presupuestos: presupuestosData,
                        notificaciones: notificacionesData,
                        unreadCount: unreadData
                    });
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setIsAuthenticated(false);
                window.location.reload();
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600 mx-auto"></div>
                            <p className="mt-4 text-gray-600">Cargando...</p>
                        </div>
                    </div>
                );
            }

            if (!isAuthenticated) {
                return <LoginForm onLoginSuccess={() => { setIsAuthenticated(true); loadData(); }} />;
            }

            const user = JSON.parse(localStorage.getItem('user') || '{}');

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Sidebar */}
                    <div className="fixed inset-y-0 left-0 w-64 bg-white shadow-lg">
                        <div className="h-full flex flex-col">
                            {/* Logo */}
                            <div className="p-6 gradient-bg">
                                <h1 className="text-2xl font-bold text-white">üí∞ FinanzApp</h1>
                                <p className="text-sm text-indigo-100 mt-1">{user.nombre}</p>
                            </div>

                            {/* Navigation */}
                            <nav className="flex-1 p-4 space-y-1">
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                        currentView === 'dashboard'
                                            ? 'bg-indigo-50 text-indigo-600 font-medium'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    <Icons.Dashboard />
                                    <span>Dashboard</span>
                                </button>

                                <button
                                    onClick={() => setCurrentView('movements')}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                        currentView === 'movements'
                                            ? 'bg-indigo-50 text-indigo-600 font-medium'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    <Icons.Movements />
                                    <span>Movimientos</span>
                                </button>

                                <button
                                    onClick={() => setCurrentView('budgets')}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                        currentView === 'budgets'
                                            ? 'bg-indigo-50 text-indigo-600 font-medium'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    <Icons.Budget />
                                    <span>Presupuestos</span>
                                </button>

                                <button
                                    onClick={() => setCurrentView('notifications')}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                        currentView === 'notifications'
                                            ? 'bg-indigo-50 text-indigo-600 font-medium'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    <Icons.Notifications />
                                    <span>Notificaciones</span>
                                    {data.unreadCount > 0 && (
                                        <span className="ml-auto bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                                            {data.unreadCount}
                                        </span>
                                    )}
                                </button>

                                <button
                                    onClick={() => setCurrentView('reports')}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                        currentView === 'reports'
                                            ? 'bg-indigo-50 text-indigo-600 font-medium'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    <Icons.Reports />
                                    <span>Reportes</span>
                                </button>
                            </nav>

                            {/* Logout */}
                            <div className="p-4 border-t border-gray-200">
                                <button
                                    onClick={handleLogout}
                                    className="w-full flex items-center space-x-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                >
                                    <Icons.Logout />
                                    <span>Cerrar Sesi√≥n</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="ml-64 p-8">
                        <div className="max-w-7xl mx-auto">
                            {currentView === 'dashboard' && (
                                <Dashboard data={data} onRefresh={() => setCurrentView('movements')} />
                            )}
                            {currentView === 'movements' && (
                                <MovementsList
                                    movimientos={data.movimientos}
                                    categorias={data.categorias}
                                    onUpdate={loadData}
                                />
                            )}
                            {currentView === 'budgets' && (
                                <BudgetsList
                                    presupuestos={data.presupuestos}
                                    categorias={data.categorias}
                                    onUpdate={loadData}
                                />
                            )}
                            {currentView === 'notifications' && (
                                <NotificationsCenter
                                    notificaciones={data.notificaciones}
                                    onUpdate={loadData}
                                />
                            )}
                            {currentView === 'reports' && <Reports />}
                        </div>
                    </div>
                </div>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>